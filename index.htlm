<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéñÔ∏è PMM COMMAND CENTER - Sistema Integral de Estudio</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg:#0a0a12;--bg2:#0f0f1a;--bg3:#14141f;
            --gold:#ffd700;--gold-dim:#b8860b;
            --cyan:#00d4ff;--green:#10b981;--red:#ef4444;--orange:#f97316;
            --text:#f1f5f9;--text2:#94a3b8;--text3:#64748b;
            --border:#1e293b;--accent:#6366f1;
        }
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Rajdhani',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}
        
        /* === HEADER PRINCIPAL === */
        .main-header{background:linear-gradient(180deg,rgba(0,0,0,.9),rgba(10,10,18,.95));border-bottom:3px solid var(--gold);padding:15px 20px;position:fixed;top:0;left:0;right:0;z-index:1000;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px}
        .logo{display:flex;align-items:center;gap:12px}
        .logo-badge{width:45px;height:45px;background:linear-gradient(135deg,var(--gold),var(--gold-dim));border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.3rem;animation:pulse 2s infinite}
        @keyframes pulse{0%,100%{box-shadow:0 0 15px rgba(255,215,0,.3)}50%{box-shadow:0 0 30px rgba(255,215,0,.6)}}
        .logo h1{font-family:'Orbitron',sans-serif;font-size:1.1rem;color:var(--gold);letter-spacing:2px}
        .logo p{font-size:.7rem;color:var(--text3)}
        
        /* === NAV TABS === */
        .nav-tabs{display:flex;gap:5px;flex-wrap:wrap}
        .nav-tab{padding:10px 18px;background:var(--bg3);border:2px solid var(--border);border-radius:10px;color:var(--text2);font-weight:600;cursor:pointer;transition:all .3s;font-size:.85rem;display:flex;align-items:center;gap:6px}
        .nav-tab:hover{border-color:var(--gold);color:var(--gold)}
        .nav-tab.active{background:linear-gradient(135deg,var(--gold),var(--gold-dim));color:var(--bg);border-color:var(--gold)}
        .nav-tab-icon{font-size:1rem}
        
        /* === STATS HEADER === */
        .header-stats{display:flex;gap:15px}
        .h-stat{text-align:center;padding:5px 12px;background:rgba(255,215,0,.1);border-radius:8px;border:1px solid rgba(255,215,0,.2)}
        .h-stat-val{font-family:'Orbitron',sans-serif;font-size:1.1rem;color:var(--gold);font-weight:700}
        .h-stat-lbl{font-size:.65rem;color:var(--text3);text-transform:uppercase}
        
        /* === CONTENIDO PRINCIPAL === */
        .main-content{margin-top:85px;min-height:calc(100vh - 85px)}
        .module{display:none;padding:20px;max-width:1400px;margin:0 auto}
        .module.active{display:block;animation:fadeIn .4s ease}
        @keyframes fadeIn{from{opacity:0;transform:translateY(15px)}to{opacity:1;transform:translateY(0)}}
        
        /* === CARDS GENERALES === */
        .card{background:var(--bg3);border:1px solid var(--border);border-radius:15px;padding:25px;margin-bottom:20px;position:relative;overflow:hidden}
        .card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--gold),var(--cyan))}
        .card-title{font-family:'Orbitron',sans-serif;font-size:1rem;color:var(--gold);margin-bottom:20px;display:flex;align-items:center;gap:10px;letter-spacing:1px}
        
        /* === BIBLIOTECA === */
        .bib-grid{display:grid;grid-template-columns:280px 1fr;gap:20px;min-height:calc(100vh - 130px)}
        @media(max-width:900px){.bib-grid{grid-template-columns:1fr}}
        .bib-sidebar{background:var(--bg2);border:1px solid var(--border);border-radius:15px;padding:20px;height:fit-content;position:sticky;top:100px}
        .bib-search{width:100%;padding:12px 15px;background:var(--bg);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:.9rem;margin-bottom:15px}
        .bib-search:focus{outline:none;border-color:var(--gold)}
        .bib-nav-title{font-size:.7rem;text-transform:uppercase;letter-spacing:2px;color:var(--text3);margin:15px 0 10px;font-weight:600}
        .bib-nav-item{display:flex;align-items:center;gap:10px;padding:12px;border-radius:10px;cursor:pointer;transition:all .2s;margin-bottom:5px;border-left:3px solid transparent}
        .bib-nav-item:hover{background:rgba(255,215,0,.1)}
        .bib-nav-item.active{background:rgba(255,215,0,.15);border-left-color:var(--gold)}
        .bib-nav-item .icon{font-size:1.2rem}
        .bib-nav-item .info{flex:1}
        .bib-nav-item .title{font-weight:600;font-size:.9rem}
        .bib-nav-item .sub{font-size:.75rem;color:var(--text3)}
        .bib-content{background:var(--bg2);border:1px solid var(--border);border-radius:15px;padding:30px}
        .bib-article h2{font-family:'Orbitron',sans-serif;font-size:1.3rem;color:var(--gold);margin:30px 0 15px;padding-left:15px;border-left:3px solid var(--gold)}
        .bib-article h3{font-size:1.1rem;color:var(--cyan);margin:20px 0 10px}
        .bib-article p{line-height:1.8;margin-bottom:15px;color:var(--text2)}
        .bib-article ul{margin:15px 0;padding-left:25px}
        .bib-article li{margin-bottom:8px;line-height:1.6}
        .highlight{background:rgba(255,215,0,.1);border:1px solid var(--gold);border-radius:10px;padding:15px 20px;margin:20px 0}
        .highlight.info{background:rgba(0,212,255,.1);border-color:var(--cyan)}
        .highlight.danger{background:rgba(239,68,68,.1);border-color:var(--red)}
        .highlight.success{background:rgba(16,185,129,.1);border-color:var(--green)}
        .highlight-title{font-weight:700;font-size:.85rem;margin-bottom:8px;text-transform:uppercase;letter-spacing:1px}
        .highlight .highlight-title{color:var(--gold)}
        .highlight.info .highlight-title{color:var(--cyan)}
        .highlight.danger .highlight-title{color:var(--red)}
        .highlight.success .highlight-title{color:var(--green)}
        .legal-box{font-family:'JetBrains Mono',monospace;background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:15px;margin:15px 0;font-size:.9rem;line-height:1.7}
        .legal-box .art{color:var(--cyan);font-weight:600}
        .legal-box .pena{color:var(--gold)}
        
        /* === TESTS === */
        .test-menu{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-bottom:30px}
        .test-mode-card{background:linear-gradient(145deg,rgba(255,215,0,.05),var(--bg3));border:2px solid var(--border);border-radius:15px;padding:25px;cursor:pointer;transition:all .3s;text-align:center}
        .test-mode-card:hover{border-color:var(--gold);transform:translateY(-5px);box-shadow:0 10px 30px rgba(255,215,0,.1)}
        .test-mode-card .icon{font-size:2.5rem;margin-bottom:15px}
        .test-mode-card .name{font-family:'Orbitron',sans-serif;font-size:1rem;color:var(--gold);margin-bottom:8px}
        .test-mode-card .desc{font-size:.85rem;color:var(--text3)}
        .test-tema-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(130px,1fr));gap:12px;margin-top:20px}
        .test-tema-btn{background:var(--bg);border:2px solid var(--border);border-radius:10px;padding:15px;cursor:pointer;transition:all .2s;text-align:center}
        .test-tema-btn:hover{border-color:var(--gold);background:rgba(255,215,0,.1)}
        .test-tema-btn .icon{font-size:1.5rem;margin-bottom:8px}
        .test-tema-btn .name{font-size:.8rem;font-weight:600}
        .test-area{display:none}
        .test-area.active{display:block}
        .test-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:15px}
        .test-badge{background:var(--gold);color:var(--bg);padding:6px 15px;border-radius:20px;font-family:'Orbitron',sans-serif;font-weight:700;font-size:.8rem}
        .test-timer{font-family:'Orbitron',sans-serif;font-size:1.3rem;color:var(--gold)}
        .test-progress{height:5px;background:var(--border);border-radius:3px;margin-bottom:20px;overflow:hidden}
        .test-progress-fill{height:100%;background:linear-gradient(90deg,var(--gold),var(--green));transition:width .5s}
        .question-card{background:var(--bg);border:2px solid var(--border);border-radius:15px;padding:25px;margin-bottom:20px;position:relative}
        .q-number{position:absolute;top:-12px;left:20px;background:var(--gold);color:var(--bg);padding:4px 15px;border-radius:15px;font-family:'Orbitron',sans-serif;font-weight:700;font-size:.85rem}
        .q-text{font-size:1.1rem;line-height:1.7;margin-top:10px}
        .options{display:flex;flex-direction:column;gap:10px;margin-top:20px}
        .opt-btn{background:var(--bg3);border:2px solid var(--border);border-radius:10px;padding:15px;text-align:left;cursor:pointer;transition:all .3s;display:flex;align-items:center;gap:12px;font-size:.95rem}
        .opt-btn:hover:not(.disabled){border-color:var(--gold);background:rgba(255,215,0,.1);transform:translateX(5px)}
        .opt-btn .letter{background:var(--border);color:var(--text);width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:'Orbitron',sans-serif;font-weight:700;flex-shrink:0}
        .opt-btn.correct{border-color:var(--green);background:rgba(16,185,129,.2)}.opt-btn.correct .letter{background:var(--green)}
        .opt-btn.incorrect{border-color:var(--red);background:rgba(239,68,68,.2);animation:shake .5s}.opt-btn.incorrect .letter{background:var(--red)}
        .opt-btn.disabled{cursor:not-allowed;opacity:.7}
        @keyframes shake{0%,100%{transform:translateX(0)}20%,60%{transform:translateX(-8px)}40%,80%{transform:translateX(8px)}}
        .feedback{display:none;background:var(--bg);border:2px solid var(--border);border-radius:10px;padding:20px;margin-top:15px}
        .feedback.show{display:block}
        .feedback-title{font-family:'Orbitron',sans-serif;font-size:1rem;margin-bottom:10px}
        .feedback-title.correct{color:var(--green)}
        .feedback-title.incorrect{color:var(--red)}
        .feedback-exp{color:var(--text2);font-size:.9rem;line-height:1.6}
        .feedback-art{margin-top:10px;padding:10px;background:rgba(255,215,0,.1);border-left:3px solid var(--gold);font-family:'JetBrains Mono',monospace;font-size:.85rem}
        .test-btns{display:flex;gap:15px;margin-top:20px;flex-wrap:wrap}
        .btn{padding:12px 25px;border:none;border-radius:10px;font-family:'Rajdhani',sans-serif;font-size:.95rem;font-weight:700;cursor:pointer;transition:all .3s;text-transform:uppercase;letter-spacing:1px;display:flex;align-items:center;gap:8px}
        .btn-gold{background:linear-gradient(135deg,var(--gold),var(--gold-dim));color:var(--bg)}
        .btn-gold:hover{box-shadow:0 5px 20px rgba(255,215,0,.4);transform:translateY(-2px)}
        .btn-outline{background:transparent;border:2px solid var(--gold);color:var(--gold)}
        .btn-red{background:linear-gradient(135deg,var(--red),#b02a37);color:white}
        .btn-green{background:linear-gradient(135deg,var(--green),#059669);color:white}
        .test-results{display:none;text-align:center;padding:40px 20px}
        .test-results.active{display:block}
        .results-icon{font-size:4rem;margin-bottom:20px;animation:bounce 1s infinite}
        @keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-15px)}}
        .results-title{font-family:'Orbitron',sans-serif;font-size:2rem;margin-bottom:10px}
        .results-title.win{color:var(--green)}.results-title.lose{color:var(--red)}
        .results-stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:15px;max-width:500px;margin:25px auto}
        .r-stat{background:rgba(255,215,0,.1);border:1px solid var(--border);border-radius:10px;padding:15px}
        .r-stat-val{font-family:'Orbitron',sans-serif;font-size:1.5rem;color:var(--gold)}
        .r-stat-lbl{font-size:.75rem;color:var(--text3);margin-top:5px}
        
        /* === ANALYTICS === */
        .analytics-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px}
        .stat-big{text-align:center;padding:30px}
        .stat-big-val{font-family:'Orbitron',sans-serif;font-size:3rem;background:linear-gradient(135deg,var(--green),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .stat-big-lbl{font-size:.9rem;color:var(--text3);margin-top:5px}
        .subject-item{display:flex;align-items:center;gap:15px;padding:12px 0;border-bottom:1px solid var(--border)}
        .subject-item:last-child{border-bottom:none}
        .subject-icon{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.2rem}
        .subject-info{flex:1}
        .subject-name{font-weight:600;margin-bottom:5px}
        .subject-bar{height:6px;background:var(--border);border-radius:3px;overflow:hidden}
        .subject-bar-fill{height:100%;border-radius:3px;transition:width 1s}
        .subject-pct{font-family:'Orbitron',sans-serif;font-size:1rem;font-weight:700;min-width:50px;text-align:right}
        
        /* === PLAN === */
        .plan-header{text-align:center;margin-bottom:30px}
        .plan-title{font-family:'Orbitron',sans-serif;font-size:1.8rem;color:var(--gold);margin-bottom:10px}
        .plan-lema{color:var(--text2);font-size:1rem}
        .week-progress{background:var(--bg);border-radius:15px;height:50px;position:relative;overflow:hidden;border:2px solid var(--border);margin:20px 0}
        .week-progress-fill{height:100%;background:linear-gradient(90deg,var(--red),var(--gold-dim),var(--green));border-radius:13px;transition:width .8s;display:flex;align-items:center;justify-content:flex-end;padding-right:15px}
        .week-progress-fill::after{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);animation:shimmer 2s infinite}
        @keyframes shimmer{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}
        .week-pct{font-family:'Orbitron',sans-serif;font-size:1.5rem;font-weight:900;color:var(--bg);z-index:1}
        .schedule-table{width:100%;border-collapse:separate;border-spacing:0;border-radius:10px;overflow:hidden}
        .schedule-table th{background:linear-gradient(180deg,var(--gold),var(--gold-dim));color:var(--bg);padding:12px;font-family:'Orbitron',sans-serif;font-size:.8rem}
        .schedule-table td{background:var(--bg);padding:12px;border-bottom:1px solid var(--border);font-size:.85rem}
        .schedule-table tr:hover td{background:rgba(255,215,0,.05)}
        .task-tag{display:inline-block;padding:3px 8px;border-radius:5px;font-size:.75rem;margin:2px;font-weight:600}
        .tag-tests{background:#17a2b8}.tag-pdf{background:#fd7e14}.tag-repaso{background:#20c997}.tag-sim{background:#6f42c1}
        .check-cell{text-align:center}
        .check-btn{width:28px;height:28px;border-radius:6px;border:2px solid var(--gold);background:transparent;color:var(--gold);cursor:pointer;font-size:1rem;transition:all .2s}
        .check-btn.done{background:var(--gold);color:var(--bg)}
        .motivation-box{background:linear-gradient(135deg,rgba(255,215,0,.1),var(--bg3));border:2px solid var(--gold);border-radius:15px;padding:30px;text-align:center;margin-top:20px}
        .motivation-quote{font-size:1.2rem;font-style:italic;color:var(--gold);line-height:1.6;margin-bottom:15px}
        .motivation-author{color:var(--text3);font-size:.9rem}
        
        /* === RESPONSIVE === */
        @media(max-width:768px){
            .main-header{flex-direction:column;text-align:center}
            .nav-tabs{justify-content:center}
            .header-stats{display:none}
            .bib-sidebar{position:relative;top:0}
            .nav-tab{padding:8px 12px;font-size:.8rem}
            .nav-tab span:not(.nav-tab-icon){display:none}
        }
        
        /* === LIVES DISPLAY === */
        .lives{display:flex;gap:3px;align-items:center}
        .life{font-size:1.2rem;transition:all .3s}.life.lost{opacity:.2;transform:scale(.8)}
        .streak-display{display:flex;align-items:center;gap:8px}
        .streak-fire{font-size:1.3rem;animation:pulse 1s infinite}
        .streak-num{font-family:'Orbitron',sans-serif;font-size:1.2rem;color:var(--gold);font-weight:700}
    </style>
</head>
<body>
    <!-- ========== HEADER PRINCIPAL ========== -->
    <header class="main-header">
        <div class="logo">
            <div class="logo-badge">üéñÔ∏è</div>
            <div>
                <h1>PMM COMMAND CENTER</h1>
                <p>Sistema Integral ¬∑ Plan Santo Grial 2026</p>
            </div>
        </div>
        
        <nav class="nav-tabs">
            <div class="nav-tab active" onclick="showModule('biblioteca')">
                <span class="nav-tab-icon">üìö</span>
                <span>Biblioteca</span>
            </div>
            <div class="nav-tab" onclick="showModule('tests')">
                <span class="nav-tab-icon">‚ö°</span>
                <span>Tests</span>
            </div>
            <div class="nav-tab" onclick="showModule('analytics')">
                <span class="nav-tab-icon">üìä</span>
                <span>Analytics</span>
            </div>
            <div class="nav-tab" onclick="showModule('plan')">
                <span class="nav-tab-icon">üéØ</span>
                <span>Plan</span>
            </div>
        </nav>
        
        <div class="header-stats">
            <div class="h-stat">
                <div class="h-stat-val" id="globalTests">0</div>
                <div class="h-stat-lbl">Tests</div>
            </div>
            <div class="h-stat">
                <div class="h-stat-val" id="globalAcc">0%</div>
                <div class="h-stat-lbl">Precisi√≥n</div>
            </div>
            <div class="h-stat">
                <div class="streak-display">
                    <span class="streak-fire">üî•</span>
                    <span class="streak-num" id="globalStreak">0</span>
                </div>
                <div class="h-stat-lbl">Racha</div>
            </div>
        </div>
    </header>

    <!-- ========== CONTENIDO PRINCIPAL ========== -->
    <main class="main-content">
        
        <!-- ========== M√ìDULO: BIBLIOTECA ========== -->
        <div class="module active" id="mod-biblioteca">
            <div class="bib-grid">
                <aside class="bib-sidebar">
                    <input type="text" class="bib-search" placeholder="üîç Buscar contenido..." id="bibSearch" oninput="filterBib()">
                    
                    <div class="bib-nav-title">üìú Constituci√≥n Espa√±ola</div>
                    <div class="bib-nav-item active" onclick="loadContent('ce-preliminar')">
                        <span class="icon">üìã</span>
                        <div class="info"><div class="title">T√≠tulo Preliminar</div><div class="sub">Arts. 1-9</div></div>
                    </div>
                    <div class="bib-nav-item" onclick="loadContent('ce-titulo1')">
                        <span class="icon">‚öñÔ∏è</span>
                        <div class="info"><div class="title">T√≠tulo I: Derechos</div><div class="sub">Arts. 10-55</div></div>
                    </div>
                    <div class="bib-nav-item" onclick="loadContent('ce-titulo2')">
                        <span class="icon">üëë</span>
                        <div class="info"><div class="title">T√≠tulo II: La Corona</div><div class="sub">Arts. 56-65</div></div>
                    </div>
                    
                    <div class="bib-nav-title">üìã Decreto 210/2021</div>
                    <div class="bib-nav-item" onclick="loadContent('d210-estructura')">
                        <span class="icon">üèõÔ∏è</span>
                        <div class="info"><div class="title">Estructura y Escalas</div><div class="sub">T√≠tulos I-II</div></div>
                    </div>
                    <div class="bib-nav-item" onclick="loadContent('d210-seleccion')">
                        <span class="icon">üìù</span>
                        <div class="info"><div class="title">Selecci√≥n y Promoci√≥n</div><div class="sub">T√≠tulos III-IV</div></div>
                    </div>
                    <div class="bib-nav-item" onclick="loadContent('d210-formacion')">
                        <span class="icon">üéì</span>
                        <div class="info"><div class="title">Formaci√≥n</div><div class="sub">T√≠tulo V</div></div>
                    </div>
                    
                    <div class="bib-nav-title">‚öñÔ∏è C√≥digo Penal</div>
                    <div class="bib-nav-item" onclick="loadContent('cp-seguridad')">
                        <span class="icon">üö®</span>
                        <div class="info"><div class="title">Seguridad Colectiva</div><div class="sub">Arts. 147-156</div></div>
                    </div>
                    <div class="bib-nav-item" onclick="loadContent('cp-vial')">
                        <span class="icon">üöó</span>
                        <div class="info"><div class="title">Seguridad Vial</div><div class="sub">Arts. 379-385</div></div>
                    </div>
                    <div class="bib-nav-item" onclick="loadContent('cp-funcionarios')">
                        <span class="icon">üè¢</span>
                        <div class="info"><div class="title">Delitos Funcionarios</div><div class="sub">Arts. 404-435</div></div>
                    </div>
                    <div class="bib-nav-item" onclick="loadContent('cp-drogas')">
                        <span class="icon">üíä</span>
                        <div class="info"><div class="title">Salud P√∫blica</div><div class="sub">Arts. 359-378</div></div>
                    </div>
                </aside>
                
                <div class="bib-content">
                    <div id="bibArticle" class="bib-article">
                        <!-- Contenido din√°mico -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ========== M√ìDULO: TESTS ========== -->
        <div class="module" id="mod-tests">
            <!-- Men√∫ de modos -->
            <div id="testMenu">
                <div class="card">
                    <div class="card-title">‚ö° SELECCIONA MODO DE COMBATE</div>
                    <div class="test-menu">
                        <div class="test-mode-card" onclick="selectMode('combate')">
                            <div class="icon">‚öîÔ∏è</div>
                            <div class="name">MODO COMBATE</div>
                            <div class="desc">3 vidas ¬∑ Tests infinitos</div>
                        </div>
                        <div class="test-mode-card" onclick="selectMode('neural')">
                            <div class="icon">üß†</div>
                            <div class="name">DESCARGA NEURAL</div>
                            <div class="desc">50 preguntas sin parar</div>
                        </div>
                        <div class="test-mode-card" onclick="selectMode('simulacro')">
                            <div class="icon">üéØ</div>
                            <div class="name">SIMULACRO</div>
                            <div class="desc">100 preguntas ¬∑ 90 min</div>
                        </div>
                        <div class="test-mode-card" onclick="selectMode('zen')">
                            <div class="icon">üßò</div>
                            <div class="name">MODO ZEN</div>
                            <div class="desc">Sin presi√≥n ¬∑ Aprende</div>
                        </div>
                    </div>
                </div>
                
                <div class="card" id="temaSelector" style="display:none">
                    <div class="card-title">üìö SELECCIONA MATERIA</div>
                    <div class="test-tema-grid">
                        <div class="test-tema-btn" onclick="selectTema('todos')"><div class="icon">üåê</div><div class="name">TODOS</div></div>
                        <div class="test-tema-btn" onclick="selectTema('constitucion')"><div class="icon">üìú</div><div class="name">CONSTITUCI√ìN</div></div>
                        <div class="test-tema-btn" onclick="selectTema('decreto')"><div class="icon">üìã</div><div class="name">DECRETO 210</div></div>
                        <div class="test-tema-btn" onclick="selectTema('penal')"><div class="icon">‚öñÔ∏è</div><div class="name">C√ìDIGO PENAL</div></div>
                        <div class="test-tema-btn" onclick="selectTema('trafico')"><div class="icon">üöó</div><div class="name">TR√ÅFICO</div></div>
                    </div>
                </div>
            </div>
            
            <!-- √Årea de test activo -->
            <div class="test-area" id="testArea">
                <div class="test-header">
                    <div style="display:flex;gap:15px;align-items:center">
                        <span class="test-badge" id="testBadge">TEMA</span>
                        <span id="testCount" style="color:var(--text2)">Pregunta 1</span>
                        <div class="lives" id="livesDisplay"></div>
                    </div>
                    <div class="test-timer" id="testTimer">00:00</div>
                </div>
                
                <div class="test-progress"><div class="test-progress-fill" id="testProgressFill" style="width:0%"></div></div>
                
                <div class="question-card">
                    <span class="q-number" id="qNumber">Q1</span>
                    <p class="q-text" id="qText">Cargando pregunta...</p>
                </div>
                
                <div class="options" id="optionsContainer"></div>
                
                <div class="feedback" id="feedbackBox">
                    <div class="feedback-title" id="feedbackTitle">Correcto</div>
                    <p class="feedback-exp" id="feedbackExp"></p>
                    <div class="feedback-art" id="feedbackArt"></div>
                </div>
                
                <div class="test-btns">
                    <button class="btn btn-gold" id="nextBtn" onclick="nextQuestion()" style="display:none">SIGUIENTE ‚Üí</button>
                    <button class="btn btn-red" onclick="endTest()">‚úï TERMINAR</button>
                </div>
            </div>
            
            <!-- Resultados -->
            <div class="test-results" id="testResults">
                <div class="results-icon" id="resultsIcon">üèÜ</div>
                <h2 class="results-title" id="resultsTitle">¬°COMPLETADO!</h2>
                <p style="color:var(--text2)" id="resultsSub">Resultados del combate</p>
                <div class="results-stats">
                    <div class="r-stat"><div class="r-stat-val" id="resCor">0</div><div class="r-stat-lbl">Correctas</div></div>
                    <div class="r-stat"><div class="r-stat-val" id="resInc">0</div><div class="r-stat-lbl">Incorrectas</div></div>
                    <div class="r-stat"><div class="r-stat-val" id="resAcc">0%</div><div class="r-stat-lbl">Precisi√≥n</div></div>
                    <div class="r-stat"><div class="r-stat-val" id="resStreak">0</div><div class="r-stat-lbl">Mejor Racha</div></div>
                    <div class="r-stat"><div class="r-stat-val" id="resTime">00:00</div><div class="r-stat-lbl">Tiempo</div></div>
                </div>
                <div class="test-btns" style="justify-content:center">
                    <button class="btn btn-gold" onclick="restartTest()">üîÑ REPETIR</button>
                    <button class="btn btn-outline" onclick="backToMenu()">üè† MEN√ö</button>
                </div>
            </div>
        </div>
        
        <!-- ========== M√ìDULO: ANALYTICS ========== -->
        <div class="module" id="mod-analytics">
            <div class="analytics-grid">
                <div class="card">
                    <div class="card-title">üìà PREDICCI√ìN APROBADO</div>
                    <div class="stat-big">
                        <div class="stat-big-val" id="predictionPct">0%</div>
                        <div class="stat-big-lbl">Precisi√≥n Media Global</div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">üìö RENDIMIENTO POR MATERIA</div>
                    <div id="subjectsAnalytics">
                        <!-- Din√°mico -->
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">üî• ESTAD√çSTICAS GLOBALES</div>
                    <div class="analytics-grid" style="gap:10px">
                        <div class="r-stat"><div class="r-stat-val" id="anTotalTests">0</div><div class="r-stat-lbl">Tests Totales</div></div>
                        <div class="r-stat"><div class="r-stat-val" id="anTotalQ">0</div><div class="r-stat-lbl">Preguntas</div></div>
                        <div class="r-stat"><div class="r-stat-val" id="anBestStreak">0</div><div class="r-stat-lbl">Mejor Racha</div></div>
                        <div class="r-stat"><div class="r-stat-val" id="anStudyDays">0</div><div class="r-stat-lbl">D√≠as Estudio</div></div>
                    </div>
                </div>
                
                <div class="card" style="grid-column:1/-1">
                    <div class="card-title">üí° RECOMENDACIONES DEL SISTEMA</div>
                    <div id="recommendations" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:15px">
                        <!-- Din√°mico -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ========== M√ìDULO: PLAN ========== -->
        <div class="module" id="mod-plan">
            <div class="card">
                <div class="plan-header">
                    <h2 class="plan-title">üéØ PLAN SANTO GRIAL 2026</h2>
                    <p class="plan-lema">‚öîÔ∏è 30 MIN/D√çA = PLAZA SEGURA ‚öîÔ∏è</p>
                </div>
                
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;flex-wrap:wrap;gap:10px">
                    <span style="background:var(--gold);color:var(--bg);padding:8px 20px;border-radius:25px;font-family:'Orbitron',sans-serif;font-weight:700" id="weekBadge">SEMANA 1</span>
                    <span style="color:var(--text2)" id="weekTarget">üéØ Target: 70%</span>
                </div>
                
                <div class="week-progress">
                    <div class="week-progress-fill" id="weekProgressFill" style="width:0%">
                        <span class="week-pct" id="weekPct">0%</span>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">üìÖ PLANIFICACI√ìN SEMANAL</div>
                <div style="overflow-x:auto">
                    <table class="schedule-table">
                        <thead>
                            <tr><th>D√çA</th><th>TAREAS (30 min)</th><th>‚úì</th></tr>
                        </thead>
                        <tbody id="scheduleBody">
                            <!-- Din√°mico -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="motivation-box">
                <p class="motivation-quote" id="motivationQuote">"El dolor de la disciplina pesa gramos, el del arrepentimiento pesa toneladas."</p>
                <p class="motivation-author" id="motivationAuthor">‚Äî Jim Rohn</p>
                <button class="btn btn-gold" style="margin-top:15px" onclick="newQuote()">üîÑ NUEVA FRASE</button>
            </div>
        </div>
    </main>

<script>
// ==================== DATOS GLOBALES ====================
const DB = {
    stats: { tests: 0, correct: 0, incorrect: 0, streak: 0, bestStreak: 0, studyDays: 0 },
    subjects: {
        constitucion: { name: 'Constituci√≥n', icon: 'üìú', correct: 0, total: 0, color: '#6366f1' },
        decreto: { name: 'Decreto 210', icon: 'üìã', correct: 0, total: 0, color: '#22d3ee' },
        penal: { name: 'C√≥digo Penal', icon: '‚öñÔ∏è', correct: 0, total: 0, color: '#ec4899' },
        trafico: { name: 'Tr√°fico', icon: 'üöó', correct: 0, total: 0, color: '#f59e0b' }
    },
    plan: { week: 1, weekPct: 0, days: { lun:false, mar:false, mie:false, jue:false, vie:false, sab:false, dom:false } }
};

// ==================== BANCO DE PREGUNTAS ====================
const QUESTIONS = {
constitucion: [
    {q:"Seg√∫n art. 1.1 CE, ¬øcu√°les son los valores superiores del ordenamiento jur√≠dico?",o:["Libertad, justicia, igualdad, pluralismo pol√≠tico","Libertad, solidaridad, igualdad, pluralismo","Libertad, justicia, fraternidad, democracia","Democracia, justicia, igualdad, libertad"],c:0,e:"Art. 1.1 CE establece los 4 valores superiores: libertad, justicia, igualdad y pluralismo pol√≠tico.",a:"Art. 1.1 CE"},
    {q:"La soberan√≠a nacional reside en:",o:["El Rey","Las Cortes Generales","El pueblo espa√±ol","El Gobierno"],c:2,e:"Art. 1.2 CE: 'La soberan√≠a nacional reside en el pueblo espa√±ol, del que emanan los poderes del Estado.'",a:"Art. 1.2 CE"},
    {q:"La forma pol√≠tica del Estado espa√±ol es:",o:["Rep√∫blica parlamentaria","Monarqu√≠a constitucional","Monarqu√≠a parlamentaria","Rep√∫blica federal"],c:2,e:"Art. 1.3 CE establece que la forma pol√≠tica es la Monarqu√≠a parlamentaria.",a:"Art. 1.3 CE"},
    {q:"La capital del Estado es:",o:["La ciudad de Madrid","Madrid","La villa de Madrid","No lo establece la CE"],c:2,e:"Art. 5 CE: 'La capital del Estado es la villa de Madrid.' OJO: es 'villa', no 'ciudad'.",a:"Art. 5 CE"},
    {q:"Los espa√±oles son mayores de edad a los:",o:["16 a√±os","18 a√±os","21 a√±os","Seg√∫n determine cada CCAA"],c:1,e:"Art. 12 CE: 'Los espa√±oles son mayores de edad a los dieciocho a√±os.'",a:"Art. 12 CE"},
    {q:"El plazo m√°ximo de detenci√≥n preventiva es de:",o:["24 horas","48 horas","72 horas","96 horas"],c:2,e:"Art. 17.2 CE: m√°ximo 72 horas, pasando a disposici√≥n judicial.",a:"Art. 17.2 CE"},
    {q:"Para la entrada en domicilio se requiere:",o:["Solo consentimiento del titular","Solo resoluci√≥n judicial","Consentimiento, resoluci√≥n judicial o flagrante delito","Autorizaci√≥n administrativa"],c:2,e:"Art. 18.2 CE: tres supuestos para entrada en domicilio.",a:"Art. 18.2 CE"},
    {q:"El derecho de reuni√≥n pac√≠fica y sin armas:",o:["Requiere autorizaci√≥n previa","No necesita autorizaci√≥n previa","Solo en lugares cerrados","Requiere permiso policial"],c:1,e:"Art. 21.1 CE: no necesita autorizaci√≥n previa. En lugares p√∫blicos: comunicaci√≥n previa.",a:"Art. 21.1 CE"},
    {q:"Las penas privativas de libertad se orientan hacia:",o:["El castigo ejemplar","La reeducaci√≥n y reinserci√≥n social","La prevenci√≥n general","La protecci√≥n de la sociedad"],c:1,e:"Art. 25.2 CE: orientaci√≥n hacia reeducaci√≥n y reinserci√≥n social.",a:"Art. 25.2 CE"},
    {q:"La CE fue ratificada en refer√©ndum el:",o:["31 octubre 1978","6 diciembre 1978","27 diciembre 1978","29 diciembre 1978"],c:1,e:"El 6 de diciembre de 1978 se ratific√≥ en refer√©ndum.",a:"Cronolog√≠a CE"},
    {q:"La CE entr√≥ en vigor el:",o:["6 diciembre 1978","27 diciembre 1978","29 diciembre 1978","1 enero 1979"],c:2,e:"Entr√≥ en vigor el 29 de diciembre de 1978, con su publicaci√≥n en BOE.",a:"Disposici√≥n Final CE"},
    {q:"¬øCu√°ntos art√≠culos tiene la Constituci√≥n Espa√±ola?",o:["155","165","169","175"],c:2,e:"La CE tiene 169 art√≠culos distribuidos en 10 T√≠tulos m√°s el Preliminar.",a:"Estructura CE"},
    {q:"La bandera de Espa√±a tiene la franja amarilla de:",o:["Igual anchura que las rojas","Doble anchura que cada roja","Triple anchura","Mitad de anchura"],c:1,e:"Art. 4.1 CE: franja amarilla de doble anchura que cada una de las rojas.",a:"Art. 4.1 CE"},
    {q:"La CE se fundamenta en:",o:["La soberan√≠a nacional","Los valores superiores","La indisoluble unidad de la Naci√≥n espa√±ola","La monarqu√≠a parlamentaria"],c:2,e:"Art. 2 CE: se fundamenta en la indisoluble unidad de la Naci√≥n espa√±ola.",a:"Art. 2 CE"},
    {q:"El castellano es la lengua oficial del Estado. Los espa√±oles tienen:",o:["Solo el derecho a usarlo","Solo el deber de conocerlo","El deber de conocerlo y el derecho a usarlo","Ni deber ni derecho espec√≠fico"],c:2,e:"Art. 3.1 CE: deber de conocerlo y derecho a usarlo.",a:"Art. 3.1 CE"}
],
decreto: [
    {q:"El Decreto 210/2021 desarrolla la Ley:",o:["Ley 4/1992","Ley 1/2018 de Coordinaci√≥n de Polic√≠as Locales","Ley Org√°nica 2/1986","Ley 7/1985"],c:1,e:"Desarrolla la Ley 1/2018, de 22 de febrero, de Coordinaci√≥n de Polic√≠as Locales de la CM.",a:"Pre√°mbulo D.210/2021"},
    {q:"El n√∫mero m√≠nimo de efectivos para un Cuerpo de Polic√≠a Local es:",o:["3 efectivos","5 efectivos","10 efectivos","15 efectivos"],c:1,e:"Art. 13.1: El n√∫mero m√≠nimo de efectivos es 5.",a:"Art. 13 D.210/2021"},
    {q:"La Escala T√©cnica corresponde al subgrupo:",o:["A1","A2","C1","C2"],c:0,e:"Art. 11.2.a): Escala T√©cnica = subgrupo A1 (Comisario Principal, Comisario, Intendente).",a:"Art. 11 D.210/2021"},
    {q:"La Escala Ejecutiva corresponde al subgrupo:",o:["A1","A2","C1","C2"],c:1,e:"Art. 11.2.b): Escala Ejecutiva = subgrupo A2 (Inspector, Subinspector).",a:"Art. 11 D.210/2021"},
    {q:"La Escala B√°sica corresponde al subgrupo:",o:["A1","A2","C1","C2"],c:2,e:"Art. 11.2.c): Escala B√°sica = subgrupo C1 (Oficial, Polic√≠a).",a:"Art. 11 D.210/2021"},
    {q:"La categor√≠a de Comisario Principal es obligatoria en municipios que superen:",o:["150.000 habitantes","200.000 habitantes","300.000 habitantes","500.000 habitantes"],c:2,e:"Art. 15.1.a): obligatoria en municipios >300.000 hab o >300 efectivos.",a:"Art. 15 D.210/2021"},
    {q:"La antig√ºedad m√≠nima para promoci√≥n interna es de:",o:["1 a√±o","2 a√±os","3 a√±os","5 a√±os"],c:1,e:"Art. 54.1.c): al menos 2 a√±os de servicio activo en categor√≠a inmediata inferior.",a:"Art. 54 D.210/2021"},
    {q:"Para promoci√≥n a Comisario/Intendente si acceso fue libre, la antig√ºedad m√≠nima es:",o:["2 a√±os","4 a√±os","6 a√±os","8 a√±os"],c:2,e:"Art. 54.1.c): 6 a√±os si accedieron por acceso libre a categor√≠as inmediatas inferiores.",a:"Art. 54 D.210/2021"},
    {q:"El curso selectivo de formaci√≥n b√°sica para ingreso tiene una duraci√≥n m√≠nima de:",o:["300 horas","500 horas","625 horas","800 horas"],c:2,e:"Art. 76.2: duraci√≥n no inferior a 625 horas o equivalente en cr√©ditos ECTS.",a:"Art. 76 D.210/2021"},
    {q:"El curso selectivo para promoci√≥n interna tiene una carga de:",o:["200 horas","300 horas","400 horas","500 horas"],c:1,e:"Art. 77.3: carga lectiva de 300 horas o equivalente en cr√©ditos ECTS.",a:"Art. 77 D.210/2021"},
    {q:"La permanencia m√≠nima tras movilidad en el nuevo ayuntamiento es de:",o:["2 a√±os","3 a√±os","5 a√±os","7 a√±os"],c:2,e:"Art. 64.1.c): permanencia m√≠nima de 5 a√±os.",a:"Art. 64 D.210/2021"},
    {q:"El porcentaje reservado para movilidad en categor√≠a Polic√≠a es:",o:["10%","15%","20%","25%"],c:2,e:"Art. 64.1.a): deber√° reservarse un 20% de las plazas.",a:"Art. 64 D.210/2021"},
    {q:"El r√©gimen disciplinario de Polic√≠as Locales se rige por:",o:["Ley 30/1992","LO 4/2010 del R√©gimen disciplinario del CNP","EBEP exclusivamente","Normativa municipal"],c:1,e:"Art. 98.1: se aplica la LO 4/2010 del R√©gimen disciplinario del CNP.",a:"Art. 98 D.210/2021"},
    {q:"La categor√≠a de Oficial es obligatoria en:",o:["Municipios >5.000 hab","Municipios >10.000 hab","Municipios con plantilla policial","Todos los municipios"],c:2,e:"Art. 15.1.f): la categor√≠a de Oficial es obligatoria en municipios con plantilla policial.",a:"Art. 15 D.210/2021"},
    {q:"El Centro de Formaci√≥n Integral de Seguridad tiene rango de:",o:["Direcci√≥n General","Subdirecci√≥n General","Servicio","Secci√≥n"],c:1,e:"Art. 70.1: rango de subdirecci√≥n general.",a:"Art. 70 D.210/2021"}
],
penal: [
    {q:"Son delitos las acciones y omisiones penadas por:",o:["El C√≥digo Penal","La ley","La Constituci√≥n","El ordenamiento jur√≠dico"],c:1,e:"Art. 10 CP: 'Son delitos las acciones y omisiones dolosas o imprudentes penadas por la ley.'",a:"Art. 10 CP"},
    {q:"La pena de prisi√≥n tiene una duraci√≥n m√≠nima de:",o:["1 mes","3 meses","6 meses","1 a√±o"],c:1,e:"Art. 36.1 CP: duraci√≥n m√≠nima de 3 meses y m√°xima de 20 a√±os.",a:"Art. 36 CP"},
    {q:"El delito de homicidio (art. 138) se castiga con prisi√≥n de:",o:["5 a 10 a√±os","10 a 15 a√±os","10 a 20 a√±os","15 a 20 a√±os"],c:1,e:"Art. 138.1 CP: prisi√≥n de 10 a 15 a√±os.",a:"Art. 138 CP"},
    {q:"El delito de asesinato (art. 139) se castiga con prisi√≥n de:",o:["10 a 15 a√±os","15 a 20 a√±os","15 a 25 a√±os","20 a 25 a√±os"],c:2,e:"Art. 139.1 CP: prisi√≥n de 15 a 25 a√±os.",a:"Art. 139 CP"},
    {q:"Conducir con tasa de alcohol superior a 0,60 mg/l en aire es:",o:["Infracci√≥n administrativa","Delito leve","Delito menos grave","Falta"],c:2,e:"Art. 379.2 CP: delito si supera 0,60 mg/l aire o 1,2 g/l sangre.",a:"Art. 379.2 CP"},
    {q:"La negativa a someterse a pruebas de alcoholemia se castiga con:",o:["Multa","Prisi√≥n 3-6 meses","Prisi√≥n 6 meses a 1 a√±o","Prisi√≥n 1-2 a√±os"],c:2,e:"Art. 383 CP: prisi√≥n de 6 meses a 1 a√±o.",a:"Art. 383 CP"},
    {q:"El delito de prevaricaci√≥n (art. 404) se castiga con:",o:["Multa 6-12 meses","Prisi√≥n 6 meses a 2 a√±os","Prisi√≥n 9 meses a 3 a√±os + inhabilitaci√≥n","Prisi√≥n 1-4 a√±os"],c:2,e:"Art. 404 CP: inhabilitaci√≥n especial 9-15 a√±os. Si es administrativa: prisi√≥n 9 meses a 3 a√±os.",a:"Art. 404 CP"},
    {q:"El cohecho pasivo propio (art. 419) se castiga con prisi√≥n de:",o:["1 a 3 a√±os","2 a 4 a√±os","3 a 6 a√±os","4 a 8 a√±os"],c:2,e:"Art. 419 CP: prisi√≥n 3-6 a√±os, multa 12-24 meses, inhabilitaci√≥n especial 9-12 a√±os.",a:"Art. 419 CP"},
    {q:"La malversaci√≥n b√°sica (art. 432) se castiga con prisi√≥n de:",o:["6 meses a 3 a√±os","1 a 4 a√±os","2 a 6 a√±os","3 a 8 a√±os"],c:2,e:"Art. 432.1 CP: prisi√≥n de 2 a 6 a√±os e inhabilitaci√≥n especial.",a:"Art. 432 CP"},
    {q:"El delito de atentado contra autoridad (art. 550) se castiga con:",o:["6 meses a 2 a√±os","1 a 4 a√±os","2 a 4 a√±os","3 a 5 a√±os"],c:1,e:"Art. 550.1 CP: prisi√≥n de 1 a 4 a√±os.",a:"Art. 550 CP"},
    {q:"El delito de resistencia a la autoridad (art. 556) se castiga con:",o:["Multa 3-6 meses","Prisi√≥n 3 meses a 1 a√±o","Prisi√≥n 6 meses a 1 a√±o","Prisi√≥n 1-2 a√±os"],c:2,e:"Art. 556.1 CP: prisi√≥n de 6 meses a 1 a√±o.",a:"Art. 556 CP"},
    {q:"El delito de conducci√≥n temeraria (art. 380) se castiga con:",o:["Multa 6-12 meses","Prisi√≥n 6 meses a 2 a√±os","Prisi√≥n 1-2 a√±os","Prisi√≥n 2-5 a√±os"],c:1,e:"Art. 380.1 CP: prisi√≥n de 6 meses a 2 a√±os.",a:"Art. 380 CP"},
    {q:"El delito de tr√°fico de drogas b√°sico (art. 368) se castiga con:",o:["1 a 3 a√±os","3 a 6 a√±os (blandas) / 6 a 9 a√±os (duras)","5 a 10 a√±os","6 a 12 a√±os"],c:1,e:"Art. 368 CP: 3-6 a√±os para sustancias que no causen grave da√±o; 6-9 a√±os para las que s√≠.",a:"Art. 368 CP"},
    {q:"El hurto b√°sico (art. 234) si excede 400‚Ç¨ se castiga con:",o:["Multa 1-3 meses","Prisi√≥n 3 a 12 meses","Prisi√≥n 6 a 18 meses","Prisi√≥n 1-3 a√±os"],c:2,e:"Art. 234.1 CP: prisi√≥n de 6 a 18 meses si valor supera 400‚Ç¨.",a:"Art. 234 CP"},
    {q:"El robo con violencia (art. 242) se castiga con prisi√≥n de:",o:["1 a 3 a√±os","2 a 5 a√±os","3 a 5 a√±os","3 a 6 a√±os"],c:1,e:"Art. 242.1 CP: prisi√≥n de 2 a 5 a√±os.",a:"Art. 242 CP"}
],
trafico: [
    {q:"La tasa m√°xima de alcohol para conductores generales es:",o:["0,15 mg/l aire","0,25 mg/l aire","0,30 mg/l aire","0,50 mg/l aire"],c:1,e:"Art. 20 RGC: 0,25 mg/l en aire espirado (0,5 g/l en sangre).",a:"Art. 20 RGC"},
    {q:"La tasa m√°xima para conductores noveles y profesionales es:",o:["0,10 mg/l","0,15 mg/l","0,20 mg/l","0,25 mg/l"],c:1,e:"Art. 20 RGC: 0,15 mg/l en aire (0,3 g/l en sangre).",a:"Art. 20 RGC"},
    {q:"Se considera conductor novel al que tiene permiso con antig√ºedad inferior a:",o:["1 a√±o","2 a√±os","3 a√±os","5 a√±os"],c:1,e:"Novel: permiso con antig√ºedad inferior a 2 a√±os.",a:"RGC"},
    {q:"La velocidad m√°xima gen√©rica en v√≠as urbanas es:",o:["30 km/h","40 km/h","50 km/h","60 km/h"],c:2,e:"Art. 50 RGC: 50 km/h en traves√≠as y v√≠as urbanas.",a:"Art. 50 RGC"},
    {q:"En v√≠as urbanas de un solo carril por sentido, la velocidad m√°xima es:",o:["20 km/h","30 km/h","40 km/h","50 km/h"],c:1,e:"V√≠as de un √∫nico carril por sentido: 30 km/h.",a:"Art. 50 RGC"},
    {q:"En v√≠as de plataforma √∫nica (acera-calzada mismo nivel), la velocidad es:",o:["10 km/h","20 km/h","30 km/h","40 km/h"],c:1,e:"Plataforma √∫nica: 20 km/h.",a:"Art. 50 RGC"},
    {q:"El orden de prioridad de las se√±ales es:",o:["Verticales, sem√°foros, agentes, marcas","Agentes, sem√°foros, verticales, marcas","Sem√°foros, agentes, verticales, marcas","Agentes, verticales, sem√°foros, marcas"],c:1,e:"1¬∫ Agentes, 2¬∫ Sem√°foros, 3¬∫ Se√±ales verticales, 4¬∫ Marcas viales.",a:"Art. 143 RGC"},
    {q:"El saldo inicial de puntos del permiso es:",o:["8 puntos","10 puntos","12 puntos","15 puntos"],c:2,e:"Art. 65 TRLTSV: saldo inicial de 12 puntos (8 para noveles).",a:"Art. 65 TRLTSV"},
    {q:"El m√°ximo de puntos alcanzable es:",o:["12 puntos","14 puntos","15 puntos","16 puntos"],c:2,e:"M√°ximo 15 puntos por buen comportamiento.",a:"Art. 65 TRLTSV"},
    {q:"Saltarse un sem√°foro en rojo supone la p√©rdida de:",o:["2 puntos","3 puntos","4 puntos","6 puntos"],c:2,e:"Sem√°foro rojo: p√©rdida de 4 puntos.",a:"Anexo II TRLTSV"},
    {q:"Conducir usando el m√≥vil supone la p√©rdida de:",o:["2 puntos","3 puntos","4 puntos","6 puntos"],c:2,e:"Uso de m√≥vil: p√©rdida de 4 puntos (antes eran 3, actualizado).",a:"Anexo II TRLTSV"},
    {q:"Conducir con tasa de alcohol superior a la permitida supone:",o:["2 puntos","4 puntos","6 puntos","8 puntos"],c:2,e:"Alcohol/drogas: p√©rdida de 6 puntos.",a:"Anexo II TRLTSV"},
    {q:"El pago de una multa en los primeros 20 d√≠as reduce su importe en:",o:["25%","30%","40%","50%"],c:3,e:"Art. 94 TRLTSV: reducci√≥n del 50% por pronto pago.",a:"Art. 94 TRLTSV"},
    {q:"La distancia lateral m√≠nima para adelantar a ciclistas es:",o:["1 metro","1,5 metros","2 metros","La prudente"],c:1,e:"Art. 85 RGC: separaci√≥n lateral m√≠nima de 1,5 metros.",a:"Art. 85 RGC"},
    {q:"La ITV de un veh√≠culo nuevo de turismo se pasa por primera vez a los:",o:["2 a√±os","3 a√±os","4 a√±os","5 a√±os"],c:2,e:"Turismos nuevos: primera ITV a los 4 a√±os.",a:"RD 920/2017"}
]
};

// ==================== CONTENIDO BIBLIOTECA ====================
const CONTENT = {
'ce-preliminar': {
    title: 'T√≠tulo Preliminar de la Constituci√≥n',
    subtitle: 'Art√≠culos 1-9 ¬∑ Principios fundamentales',
    body: `
        <h2>Art√≠culo 1: Valores superiores y forma de Estado</h2>
        <p>Espa√±a se constituye en un <strong>Estado social y democr√°tico de Derecho</strong>, que propugna como valores superiores de su ordenamiento jur√≠dico:</p>
        <div class="highlight">
            <div class="highlight-title">‚ö° MEMORIZA: L-J-I-P</div>
            <p><strong>Libertad, Justicia, Igualdad y Pluralismo pol√≠tico</strong></p>
        </div>
        <div class="legal-box">
            <span class="art">Art. 1.2:</span> "La soberan√≠a nacional reside en el <strong>pueblo espa√±ol</strong>, del que emanan los poderes del Estado."<br><br>
            <span class="art">Art. 1.3:</span> "La forma pol√≠tica del Estado espa√±ol es la <strong>Monarqu√≠a parlamentaria</strong>."
        </div>
        
        <h2>Art√≠culo 2: Unidad de la Naci√≥n</h2>
        <p>La Constituci√≥n se fundamenta en la <strong>indisoluble unidad de la Naci√≥n espa√±ola</strong>, patria com√∫n e indivisible de todos los espa√±oles.</p>
        <div class="highlight danger">
            <div class="highlight-title">‚ö†Ô∏è PREGUNTA TRAMPA</div>
            <p>La CE se fundamenta en la "indisoluble unidad" (NO en la soberan√≠a, NO en los valores superiores).</p>
        </div>
        
        <h2>Art√≠culo 3: Lenguas oficiales</h2>
        <p><strong>El castellano</strong> es la lengua espa√±ola oficial del Estado. Todos los espa√±oles tienen el <strong>deber de conocerla</strong> y el <strong>derecho a usarla</strong>.</p>
        
        <h2>Art√≠culo 4: La bandera</h2>
        <p>Tres franjas horizontales: <strong>roja, amarilla y roja</strong>. La amarilla es de <strong>doble anchura</strong> que cada una de las rojas.</p>
        
        <h2>Art√≠culo 5: La capital</h2>
        <div class="highlight info">
            <div class="highlight-title">üéØ CLAVE EXAMEN</div>
            <p>"La capital del Estado es la <strong>villa de Madrid</strong>." (NO "ciudad", NO solo "Madrid")</p>
        </div>
        
        <h2>Art√≠culo 8: Fuerzas Armadas</h2>
        <p>Misi√≥n de las FFAA:</p>
        <ul>
            <li>Garantizar la <strong>soberan√≠a e independencia</strong> de Espa√±a</li>
            <li>Defender su <strong>integridad territorial</strong></li>
            <li>Defender el <strong>ordenamiento constitucional</strong></li>
        </ul>
        
        <h2>Art√≠culo 9: Principios constitucionales</h2>
        <div class="highlight success">
            <div class="highlight-title">‚úÖ PRINCIPIOS DEL 9.3</div>
            <p>Legalidad ¬∑ Jerarqu√≠a normativa ¬∑ Publicidad de las normas ¬∑ Irretroactividad de disposiciones sancionadoras no favorables ¬∑ Seguridad jur√≠dica ¬∑ Responsabilidad ¬∑ Interdicci√≥n de la arbitrariedad</p>
        </div>
    `
},
'ce-titulo1': {
    title: 'T√≠tulo I: Derechos y Deberes Fundamentales',
    subtitle: 'Art√≠culos 10-55 ¬∑ El m√°s extenso de la CE',
    body: `
        <h2>Art√≠culo 10: Dignidad de la persona</h2>
        <p>La dignidad de la persona es <strong>fundamento del orden pol√≠tico y de la paz social</strong>.</p>
        
        <h2>Art√≠culo 12: Mayor√≠a de edad</h2>
        <div class="legal-box">
            <span class="art">Art. 12:</span> "Los espa√±oles son mayores de edad a los <strong>dieciocho a√±os</strong>."
        </div>
        
        <h2>Art√≠culo 14: Igualdad ante la ley</h2>
        <p>Sin discriminaci√≥n por nacimiento, raza, sexo, religi√≥n, opini√≥n o cualquier otra condici√≥n.</p>
        
        <h2>Art√≠culo 15: Derecho a la vida</h2>
        <p>Todos tienen derecho a la <strong>vida</strong> y a la <strong>integridad f√≠sica y moral</strong>. Queda abolida la pena de muerte.</p>
        
        <h2>Art√≠culo 17: Libertad y seguridad</h2>
        <div class="highlight danger">
            <div class="highlight-title">üéØ DETENCI√ìN PREVENTIVA</div>
            <p>Plazo m√°ximo: <strong>72 horas</strong>. Derecho a habeas corpus.</p>
        </div>
        
        <h2>Art√≠culo 18: Intimidad y domicilio</h2>
        <ul>
            <li><strong>18.1:</strong> Derecho al honor, intimidad y propia imagen</li>
            <li><strong>18.2:</strong> Domicilio inviolable. Entrada solo con: <strong>consentimiento, resoluci√≥n judicial o flagrante delito</strong></li>
            <li><strong>18.3:</strong> Secreto de las comunicaciones</li>
            <li><strong>18.4:</strong> Limitaci√≥n del uso de la inform√°tica</li>
        </ul>
        
        <h2>Art√≠culo 21: Derecho de reuni√≥n</h2>
        <div class="highlight">
            <div class="highlight-title">‚ö° MEMORIZA</div>
            <p>Reuni√≥n pac√≠fica y sin armas: <strong>NO necesita autorizaci√≥n previa</strong>.<br>
            En lugares de tr√°nsito p√∫blico: <strong>comunicaci√≥n previa</strong> a la autoridad.</p>
        </div>
        
        <h2>Art√≠culo 24: Tutela judicial efectiva</h2>
        <p>Derecho a obtener tutela efectiva de jueces y tribunales sin indefensi√≥n.</p>
        
        <h2>Art√≠culo 25: Principio de legalidad penal</h2>
        <p>Nadie puede ser condenado por acciones que no constituyan delito. Las penas se orientan a la <strong>reeducaci√≥n y reinserci√≥n social</strong>.</p>
        <div class="highlight info">
            <div class="highlight-title">üí° OJO</div>
            <p>La Administraci√≥n civil <strong>NO</strong> puede imponer sanciones que impliquen privaci√≥n de libertad.</p>
        </div>
    `
},
'ce-titulo2': {
    title: 'T√≠tulo II: La Corona',
    subtitle: 'Art√≠culos 56-65',
    body: `
        <h2>Art√≠culo 56: El Rey</h2>
        <p>El Rey es el <strong>Jefe del Estado</strong>, s√≠mbolo de su unidad y permanencia. Arbitra y modera el funcionamiento regular de las instituciones.</p>
        <p>Su persona es <strong>inviolable</strong> y no est√° sujeta a responsabilidad.</p>
        
        <h2>Art√≠culo 57: Sucesi√≥n</h2>
        <p>La Corona es <strong>hereditaria</strong> en los sucesores de S.M. Don Juan Carlos I de Borb√≥n.</p>
        <p>Orden de sucesi√≥n: se prefiere la l√≠nea anterior a las posteriores; en la misma l√≠nea, el grado m√°s pr√≥ximo al m√°s remoto; en el mismo grado, el var√≥n a la mujer; en el mismo sexo, la persona de m√°s edad a la de menos.</p>
        
        <h2>Art√≠culo 62: Funciones del Rey</h2>
        <ul>
            <li>Sancionar y promulgar las leyes</li>
            <li>Convocar y disolver las Cortes Generales</li>
            <li>Convocar elecciones y refer√©ndum</li>
            <li>Proponer candidato a Presidente del Gobierno</li>
            <li>Nombrar y separar miembros del Gobierno</li>
            <li>Mando supremo de las Fuerzas Armadas</li>
            <li>Ejercer el derecho de gracia</li>
            <li>Alto Patronazgo de las Reales Academias</li>
        </ul>
        
        <h2>Art√≠culo 64: Refrendo</h2>
        <p>Los actos del Rey ser√°n refrendados por el Presidente del Gobierno o Ministros competentes. De los actos refrendados son responsables las personas que los refrenden.</p>
    `
},
'd210-estructura': {
    title: 'Decreto 210/2021: Estructura y Escalas',
    subtitle: 'T√≠tulos I y II ¬∑ Organizaci√≥n de las Polic√≠as Locales CM',
    body: `
        <h2>Objeto y √°mbito (Arts. 1-2)</h2>
        <p>Establece las normas marco para los reglamentos de organizaci√≥n de los Cuerpos de Polic√≠a Local de la Comunidad de Madrid.</p>
        <p>Es de <strong>aplicaci√≥n directa</strong> en ayuntamientos sin reglamento propio.</p>
        
        <h2>Escalas y categor√≠as (Art. 11)</h2>
        <div class="highlight">
            <div class="highlight-title">üìä ESTRUCTURA</div>
            <p><strong>Escala T√©cnica (A1):</strong> Comisario Principal, Comisario, Intendente<br>
            <strong>Escala Ejecutiva (A2):</strong> Inspector, Subinspector<br>
            <strong>Escala B√°sica (C1):</strong> Oficial, Polic√≠a</p>
        </div>
        
        <h2>N√∫mero m√≠nimo de efectivos (Art. 13)</h2>
        <div class="legal-box">
            <span class="art">Art. 13.1:</span> El n√∫mero m√≠nimo de efectivos es <span class="pena">5</span>.<br>
            <span class="art">Art. 13.2:</span> La unidad b√°sica operativa es el <span class="pena">binomio de efectivos</span>.
        </div>
        
        <h2>Criterios de creaci√≥n de categor√≠as (Art. 14)</h2>
        <ul>
            <li>Por cada 4 Polic√≠as ‚Üí 1 Oficial (plantillas <20)</li>
            <li>Por cada 6 Polic√≠as ‚Üí 1 Oficial (plantillas 20-100)</li>
            <li>Por cada 8 Polic√≠as ‚Üí 1 Oficial (plantillas >100)</li>
            <li>Por cada 3 Oficiales ‚Üí 1 Subinspector</li>
        </ul>
        
        <h2>Creaci√≥n de categor√≠as (Art. 15)</h2>
        <div class="highlight info">
            <div class="highlight-title">üéØ MEMORIZA</div>
            <p><strong>Comisario Principal:</strong> obligatorio >300.000 hab o >300 efectivos<br>
            <strong>Comisario:</strong> obligatorio >150.000 hab o >175 efectivos<br>
            <strong>Intendente:</strong> obligatorio >80.000 hab o municipios gran poblaci√≥n<br>
            <strong>Inspector:</strong> obligatorio >35.000 hab o >50 efectivos<br>
            <strong>Subinspector:</strong> obligatorio >15 efectivos<br>
            <strong>Oficial:</strong> obligatorio en todos con plantilla policial</p>
        </div>
        
        <h2>Jefatura inmediata (Art. 16)</h2>
        <p>Recae en el funcionario de <strong>mayor categor√≠a jer√°rquica</strong> del Cuerpo.</p>
    `
},
'd210-seleccion': {
    title: 'Decreto 210/2021: Selecci√≥n y Promoci√≥n',
    subtitle: 'T√≠tulos III y IV ¬∑ Procesos selectivos',
    body: `
        <h2>Promoci√≥n interna (Art. 52-62)</h2>
        <p>Sistema para cobertura de plazas de Oficial, Subinspector, Comisario y Comisario Principal.</p>
        
        <h3>Requisitos (Art. 54)</h3>
        <div class="highlight">
            <div class="highlight-title">üìã REQUISITOS PROMOCI√ìN</div>
            <ul>
                <li>Ser miembro del Cuerpo convocante</li>
                <li>No estar en segunda actividad (salvo embarazo)</li>
                <li><strong>Antig√ºedad m√≠nima 2 a√±os</strong> en categor√≠a inferior</li>
                <li><strong>6 a√±os si acceso libre</strong> a Comisario/Intendente</li>
                <li>Titulaci√≥n correspondiente al subgrupo</li>
            </ul>
        </div>
        
        <h3>Proceso selectivo (Art. 53)</h3>
        <p>Fases sucesivas: <strong>Oposici√≥n + Concurso + Curso selectivo</strong></p>
        
        <h3>Curso selectivo (Art. 61)</h3>
        <div class="legal-box">
            <span class="art">Art. 61.1:</span> Carga lectiva de <span class="pena">300 horas</span> o equivalente en cr√©ditos ECTS.<br>
            <span class="art">Art. 61.2:</span> Calificaci√≥n de 0 a 10, m√≠nimo <span class="pena">5 puntos</span> en cada asignatura.
        </div>
        
        <h2>Movilidad (Art. 63-66)</h2>
        <p>Derecho reconocido en el EBEP dentro del √°mbito territorial de la CM.</p>
        
        <div class="highlight danger">
            <div class="highlight-title">‚ö†Ô∏è DATOS CLAVE MOVILIDAD</div>
            <p><strong>Reserva obligatoria:</strong> 20% plazas categor√≠a Polic√≠a<br>
            <strong>Permanencia m√≠nima:</strong> 5 a√±os en nuevo ayuntamiento</p>
        </div>
    `
},
'd210-formacion': {
    title: 'Decreto 210/2021: Formaci√≥n',
    subtitle: 'T√≠tulo V ¬∑ Centro de Formaci√≥n Integral de Seguridad',
    body: `
        <h2>Centro de Formaci√≥n Integral de Seguridad (CFIS)</h2>
        <div class="legal-box">
            <span class="art">Art. 70.1:</span> Tiene rango de <span class="pena">Subdirecci√≥n General</span>.<br>
            <span class="art">Art. 70.2:</span> Sede en el territorio de la Comunidad de Madrid.
        </div>
        
        <h2>Funciones del CFIS (Art. 72)</h2>
        <ul>
            <li>Elaborar programas formativos e impartir cursos</li>
            <li>Colaborar en selecci√≥n de personal</li>
            <li>Promover reconocimiento acad√©mico</li>
            <li>Homologar cursos de centros municipales</li>
            <li>Planificar acciones positivas de g√©nero</li>
        </ul>
        
        <h2>Cursos de formaci√≥n</h2>
        <div class="highlight">
            <div class="highlight-title">üìö DURACI√ìN DE CURSOS</div>
            <p><strong>Ingreso (formaci√≥n b√°sica):</strong> m√≠nimo 625 horas<br>
            <strong>Promoci√≥n interna:</strong> 300 horas</p>
        </div>
        
        <h2>Centros municipales (Arts. 83-85)</h2>
        <p>Pueden impartir formaci√≥n si cumplen requisitos y son homologados por la CM.</p>
        <p>Deben contar con: aulas suficientes, instalaciones adecuadas (galer√≠a tiro, gimnasio), medios t√©cnicos y reglamento propio homologado.</p>
    `
},
'cp-seguridad': {
    title: 'C√≥digo Penal: Seguridad Colectiva',
    subtitle: 'Delitos contra la seguridad colectiva',
    body: `
        <h2>Lesiones en ri√±a (Art. 154)</h2>
        <p>Quienes ri√±eren entre s√≠ acometi√©ndose confusamente, y participando en la agresi√≥n sin que conste qui√©n caus√≥ las lesiones:</p>
        <div class="legal-box">
            <span class="pena">Pena:</span> 6 meses a 2 a√±os de prisi√≥n (si hay lesiones graves)<br>
            3 a 6 meses de prisi√≥n (si hay lesiones menos graves)
        </div>
        
        <h2>Concepto general</h2>
        <p>Los delitos contra la seguridad colectiva protegen bienes jur√≠dicos supraindividuales que afectan a la comunidad en su conjunto.</p>
        
        <div class="highlight info">
            <div class="highlight-title">üí° NOTA PMM</div>
            <p>Estos delitos son relevantes para la actuaci√≥n policial en altercados p√∫blicos, concentraciones y situaciones de riesgo colectivo.</p>
        </div>
    `
},
'cp-vial': {
    title: 'C√≥digo Penal: Seguridad Vial',
    subtitle: 'Art√≠culos 379-385 ¬∑ Delitos contra la seguridad vial',
    body: `
        <h2>Conducci√≥n con alcohol/drogas (Art. 379)</h2>
        <div class="legal-box">
            <span class="art">Art. 379.1:</span> Conducir veh√≠culo a motor con <strong>temeridad manifiesta</strong> poniendo en peligro la vida o integridad.<br>
            <span class="pena">Pena:</span> Prisi√≥n 6 meses a 2 a√±os + privaci√≥n permiso 1-6 a√±os.<br><br>
            <span class="art">Art. 379.2:</span> Conducir con tasa alcohol superior a <strong>0,60 mg/l aire</strong> o <strong>1,2 g/l sangre</strong>, o bajo influencia de drogas.<br>
            <span class="pena">Pena:</span> Prisi√≥n 3-6 meses o multa 6-12 meses + privaci√≥n permiso 1-4 a√±os.
        </div>
        
        <h2>Conducci√≥n temeraria (Art. 380)</h2>
        <div class="highlight danger">
            <div class="highlight-title">üéØ EXAMEN</div>
            <p>Temeridad manifiesta con peligro concreto: <strong>Prisi√≥n 6 meses a 2 a√±os</strong></p>
        </div>
        
        <h2>Negativa a pruebas (Art. 383)</h2>
        <div class="legal-box">
            <span class="art">Art. 383:</span> Negarse a pruebas de alcoholemia/drogas requeridas por agente.<br>
            <span class="pena">Pena:</span> <strong>Prisi√≥n 6 meses a 1 a√±o</strong> + privaci√≥n permiso 1-4 a√±os.
        </div>
        
        <h2>Conducci√≥n sin permiso (Art. 384)</h2>
        <p>Conducir habiendo perdido vigencia del permiso por p√©rdida total de puntos:</p>
        <div class="legal-box">
            <span class="pena">Pena:</span> Prisi√≥n 3-6 meses o multa 12-24 meses o TBC 31-90 d√≠as.
        </div>
        
        <h2>Creaci√≥n de grave riesgo (Art. 385)</h2>
        <p>Originar grave riesgo para la circulaci√≥n mediante:</p>
        <ul>
            <li>Colocar obst√°culos</li>
            <li>Derramar sustancias deslizantes o inflamables</li>
            <li>Alterar se√±alizaci√≥n</li>
            <li>No restablecer la seguridad de la v√≠a</li>
        </ul>
    `
},
'cp-funcionarios': {
    title: 'C√≥digo Penal: Delitos de Funcionarios',
    subtitle: 'Prevaricaci√≥n, Cohecho y Malversaci√≥n',
    body: `
        <h2>Prevaricaci√≥n administrativa (Art. 404)</h2>
        <div class="legal-box">
            <span class="art">Art. 404:</span> Autoridad o funcionario que dicte <strong>resoluci√≥n arbitraria a sabiendas de su injusticia</strong>.<br>
            <span class="pena">Pena:</span> Inhabilitaci√≥n especial 9-15 a√±os + prisi√≥n 9 meses a 3 a√±os (si causa perjuicio econ√≥mico).
        </div>
        
        <h2>Cohecho pasivo propio (Art. 419)</h2>
        <div class="highlight danger">
            <div class="highlight-title">üéØ IMPORTANTE</div>
            <p>Autoridad que recibe d√°diva por realizar acto <strong>contrario a los deberes de su cargo</strong>.</p>
        </div>
        <div class="legal-box">
            <span class="pena">Pena:</span> <strong>Prisi√≥n 3-6 a√±os</strong>, multa 12-24 meses, inhabilitaci√≥n especial 9-12 a√±os.
        </div>
        
        <h2>Cohecho pasivo impropio (Art. 420)</h2>
        <p>Recibir d√°diva por realizar acto <strong>propio de su cargo</strong> (no contrario a deberes).</p>
        <div class="legal-box">
            <span class="pena">Pena:</span> Prisi√≥n 2-4 a√±os, multa 12-24 meses, inhabilitaci√≥n especial 5-9 a√±os.
        </div>
        
        <h2>Cohecho activo (Art. 424)</h2>
        <p>Particular que ofrece o entrega d√°diva a funcionario.</p>
        <div class="legal-box">
            <span class="pena">Pena:</span> Las mismas que el funcionario corrupto.
        </div>
        
        <h2>Malversaci√≥n (Art. 432)</h2>
        <div class="legal-box">
            <span class="art">Art. 432.1:</span> Autoridad que <strong>sustrae o consiente que se sustraiga</strong> caudales p√∫blicos.<br>
            <span class="pena">Pena:</span> <strong>Prisi√≥n 2-6 a√±os</strong> + inhabilitaci√≥n especial 6-10 a√±os.
        </div>
        
        <div class="highlight">
            <div class="highlight-title">‚ö° AGRAVANTES MALVERSACI√ìN</div>
            <p>Si valor >50.000‚Ç¨ o grave da√±o: prisi√≥n 4-8 a√±os<br>
            Si valor >250.000‚Ç¨: prisi√≥n 6-12 a√±os</p>
        </div>
    `
},
'cp-drogas': {
    title: 'C√≥digo Penal: Salud P√∫blica',
    subtitle: 'Art√≠culos 359-378 ¬∑ Tr√°fico de drogas',
    body: `
        <h2>Tr√°fico de drogas (Art. 368)</h2>
        <div class="legal-box">
            <span class="art">Art. 368:</span> Actos de cultivo, elaboraci√≥n o tr√°fico de drogas t√≥xicas, estupefacientes o sustancias psicotr√≥picas.<br><br>
            <span class="pena">Sustancias que NO causan grave da√±o (cannabis, etc.):</span><br>
            Prisi√≥n <strong>1-3 a√±os</strong> y multa del tanto al duplo del valor de la droga.<br><br>
            <span class="pena">Sustancias que S√ç causan grave da√±o (coca√≠na, hero√≠na, etc.):</span><br>
            Prisi√≥n <strong>3-6 a√±os</strong> y multa del tanto al triplo.
        </div>
        
        <div class="highlight danger">
            <div class="highlight-title">‚ö†Ô∏è ACTUALIZACI√ìN</div>
            <p>Las penas han sido modificadas. Antes: 3-6 a√±os (blandas) y 6-9 a√±os (duras). Verificar versi√≥n vigente del CP.</p>
        </div>
        
        <h2>Agravantes (Art. 369)</h2>
        <p>Pena superior en grado si:</p>
        <ul>
            <li>Se facilita a menores, disminuidos o en tratamiento deshabituaci√≥n</li>
            <li>En centros docentes, militares, penitenciarios</li>
            <li>Notoria importancia (cantidad)</li>
            <li>Adulteraci√≥n que incremente el da√±o</li>
            <li>Pertenencia a organizaci√≥n</li>
            <li>El culpable es funcionario p√∫blico</li>
        </ul>
        
        <h2>Conductas atenuadas (Art. 368 in fine)</h2>
        <p>Pena inferior en grado si escasa entidad del hecho y circunstancias personales del culpable.</p>
    `
}
};

// ==================== ESTADO GLOBAL ====================
let STATE = {
    // Tests
    mode: null,
    tema: null,
    questions: [],
    currentQ: 0,
    lives: 3,
    maxLives: 3,
    streak: 0,
    bestStreak: 0,
    correct: 0,
    incorrect: 0,
    answered: false,
    startTime: null,
    timerInterval: null,
    totalQuestions: Infinity
};

// ==================== INICIALIZACI√ìN ====================
document.addEventListener('DOMContentLoaded', () => {
    loadFromStorage();
    loadContent('ce-preliminar');
    updateGlobalStats();
    renderSchedule();
    updatePlanUI();
    updateAnalytics();
});

function loadFromStorage() {
    const saved = localStorage.getItem('pmmCommandCenter');
    if (saved) {
        const data = JSON.parse(saved);
        Object.assign(DB, data);
    }
}

function saveToStorage() {
    localStorage.setItem('pmmCommandCenter', JSON.stringify(DB));
}

// ==================== NAVEGACI√ìN M√ìDULOS ====================
function showModule(mod) {
    document.querySelectorAll('.module').forEach(m => m.classList.remove('active'));
    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
    document.getElementById('mod-' + mod).classList.add('active');
    document.querySelector(`.nav-tab[onclick="showModule('${mod}')"]`).classList.add('active');
    
    if (mod === 'analytics') updateAnalytics();
    if (mod === 'plan') updatePlanUI();
}

// ==================== BIBLIOTECA ====================
function loadContent(key) {
    const content = CONTENT[key];
    if (!content) return;
    
    document.querySelectorAll('.bib-nav-item').forEach(i => i.classList.remove('active'));
    event.currentTarget?.classList.add('active');
    
    document.getElementById('bibArticle').innerHTML = `
        <h1 style="font-family:'Orbitron',sans-serif;font-size:1.5rem;color:var(--gold);margin-bottom:10px">${content.title}</h1>
        <p style="color:var(--text3);margin-bottom:30px;font-size:.9rem">${content.subtitle}</p>
        ${content.body}
    `;
}

function filterBib() {
    const query = document.getElementById('bibSearch').value.toLowerCase();
    document.querySelectorAll('.bib-nav-item').forEach(item => {
        const text = item.textContent.toLowerCase();
        item.style.display = text.includes(query) ? 'flex' : 'none';
    });
}

// ==================== TESTS ====================
function selectMode(mode) {
    STATE.mode = mode;
    switch(mode) {
        case 'combate': STATE.lives = STATE.maxLives = 3; STATE.totalQuestions = Infinity; break;
        case 'neural': STATE.lives = STATE.maxLives = Infinity; STATE.totalQuestions = 50; break;
        case 'simulacro': STATE.lives = STATE.maxLives = Infinity; STATE.totalQuestions = 100; break;
        case 'zen': STATE.lives = STATE.maxLives = Infinity; STATE.totalQuestions = Infinity; break;
    }
    document.getElementById('temaSelector').style.display = 'block';
}

function selectTema(tema) {
    STATE.tema = tema;
    generateQuestions();
    startTest();
}

function generateQuestions() {
    let pool = [];
    if (STATE.tema === 'todos') {
        Object.values(QUESTIONS).forEach(arr => pool = pool.concat(arr));
    } else {
        pool = QUESTIONS[STATE.tema] || [];
    }
    STATE.questions = shuffleArray([...pool]);
    if (STATE.totalQuestions !== Infinity && STATE.questions.length < STATE.totalQuestions) {
        while (STATE.questions.length < STATE.totalQuestions) {
            STATE.questions = STATE.questions.concat(shuffleArray([...pool]));
        }
    }
}

function shuffleArray(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
}

function startTest() {
    STATE.currentQ = 0;
    STATE.correct = STATE.incorrect = STATE.streak = STATE.bestStreak = 0;
    STATE.answered = false;
    STATE.startTime = Date.now();
    if (STATE.mode === 'combate') STATE.lives = 3;
    
    document.getElementById('testMenu').style.display = 'none';
    document.getElementById('testArea').classList.add('active');
    document.getElementById('testResults').classList.remove('active');
    
    updateLivesDisplay();
    if (STATE.mode === 'simulacro') startTimer(90 * 60);
    else startStopwatch();
    
    showQuestion();
}

function showQuestion() {
    STATE.answered = false;
    document.getElementById('nextBtn').style.display = 'none';
    document.getElementById('feedbackBox').classList.remove('show');
    
    const q = STATE.questions[STATE.currentQ];
    const n = STATE.currentQ + 1;
    
    document.getElementById('testBadge').textContent = STATE.tema === 'todos' ? 'MIX' : STATE.tema.toUpperCase();
    document.getElementById('qNumber').textContent = 'Q' + n;
    document.getElementById('testCount').textContent = STATE.totalQuestions === Infinity ? 'Pregunta ' + n : n + '/' + STATE.totalQuestions;
    document.getElementById('qText').textContent = q.q;
    
    if (STATE.totalQuestions !== Infinity) {
        document.getElementById('testProgressFill').style.width = (n / STATE.totalQuestions * 100) + '%';
    }
    
    const letters = ['A', 'B', 'C', 'D'];
    document.getElementById('optionsContainer').innerHTML = q.o.map((opt, i) => `
        <button class="opt-btn" onclick="answerQuestion(${i})">
            <span class="letter">${letters[i]}</span>
            <span>${opt}</span>
        </button>
    `).join('');
}

function answerQuestion(idx) {
    if (STATE.answered) return;
    STATE.answered = true;
    
    const q = STATE.questions[STATE.currentQ];
    const correct = idx === q.c;
    const tema = STATE.tema === 'todos' ? detectTema(q) : STATE.tema;
    
    document.querySelectorAll('.opt-btn').forEach(btn => btn.classList.add('disabled'));
    document.querySelectorAll('.opt-btn')[q.c].classList.add('correct');
    
    if (correct) {
        STATE.correct++;
        STATE.streak++;
        if (STATE.streak > STATE.bestStreak) STATE.bestStreak = STATE.streak;
        DB.stats.correct++;
        DB.subjects[tema].correct++;
        showFeedback(true, q);
    } else {
        document.querySelectorAll('.opt-btn')[idx].classList.add('incorrect');
        STATE.incorrect++;
        STATE.streak = 0;
        DB.stats.incorrect++;
        if (STATE.mode === 'combate') {
            STATE.lives--;
            updateLivesDisplay();
            if (STATE.lives <= 0) {
                setTimeout(() => endTest(true), 1200);
                return;
            }
        }
        showFeedback(false, q);
    }
    
    DB.subjects[tema].total++;
    updateGlobalStats();
    saveToStorage();
    document.getElementById('nextBtn').style.display = 'flex';
}

function detectTema(q) {
    for (const [key, arr] of Object.entries(QUESTIONS)) {
        if (arr.includes(q)) return key;
    }
    return 'constitucion';
}

function showFeedback(correct, q) {
    document.getElementById('feedbackTitle').textContent = correct ? '‚úÖ ¬°CORRECTO!' : '‚ùå INCORRECTO';
    document.getElementById('feedbackTitle').className = 'feedback-title ' + (correct ? 'correct' : 'incorrect');
    document.getElementById('feedbackExp').textContent = q.e;
    document.getElementById('feedbackArt').textContent = 'üìö ' + q.a;
    document.getElementById('feedbackBox').classList.add('show');
}

function nextQuestion() {
    STATE.currentQ++;
    if (STATE.totalQuestions !== Infinity && STATE.currentQ >= STATE.totalQuestions) {
        endTest(false);
        return;
    }
    if (STATE.currentQ >= STATE.questions.length) {
        generateQuestions();
        STATE.currentQ = 0;
    }
    showQuestion();
}

function endTest(gameOver = false) {
    if (STATE.timerInterval) clearInterval(STATE.timerInterval);
    
    DB.stats.tests++;
    DB.stats.streak = STATE.streak;
    if (STATE.bestStreak > DB.stats.bestStreak) DB.stats.bestStreak = STATE.bestStreak;
    saveToStorage();
    
    const time = Math.floor((Date.now() - STATE.startTime) / 1000);
    const timeStr = `${String(Math.floor(time/60)).padStart(2,'0')}:${String(time%60).padStart(2,'0')}`;
    const total = STATE.correct + STATE.incorrect;
    const pct = total > 0 ? Math.round(STATE.correct / total * 100) : 0;
    
    document.getElementById('testArea').classList.remove('active');
    document.getElementById('testResults').classList.add('active');
    
    if (gameOver) {
        document.getElementById('resultsIcon').textContent = 'üíÄ';
        document.getElementById('resultsTitle').textContent = 'GAME OVER';
        document.getElementById('resultsTitle').className = 'results-title lose';
    } else if (pct >= 85) {
        document.getElementById('resultsIcon').textContent = 'üèÜ';
        document.getElementById('resultsTitle').textContent = '¬°EXCELENTE!';
        document.getElementById('resultsTitle').className = 'results-title win';
    } else if (pct >= 70) {
        document.getElementById('resultsIcon').textContent = '‚≠ê';
        document.getElementById('resultsTitle').textContent = '¬°BIEN!';
        document.getElementById('resultsTitle').className = 'results-title win';
    } else {
        document.getElementById('resultsIcon').textContent = 'üìà';
        document.getElementById('resultsTitle').textContent = 'SIGUE ENTRENANDO';
        document.getElementById('resultsTitle').className = 'results-title';
    }
    
    document.getElementById('resCor').textContent = STATE.correct;
    document.getElementById('resInc').textContent = STATE.incorrect;
    document.getElementById('resAcc').textContent = pct + '%';
    document.getElementById('resStreak').textContent = STATE.bestStreak;
    document.getElementById('resTime').textContent = timeStr;
    
    updateGlobalStats();
}

function restartTest() {
    selectTema(STATE.tema);
}

function backToMenu() {
    document.getElementById('testResults').classList.remove('active');
    document.getElementById('testArea').classList.remove('active');
    document.getElementById('testMenu').style.display = 'block';
    document.getElementById('temaSelector').style.display = 'none';
}

function updateLivesDisplay() {
    const container = document.getElementById('livesDisplay');
    if (STATE.lives === Infinity) {
        container.innerHTML = '<span class="life">‚àû</span>';
        return;
    }
    let html = '';
    for (let i = 0; i < STATE.maxLives; i++) {
        html += `<span class="life${i >= STATE.lives ? ' lost' : ''}">‚ù§Ô∏è</span>`;
    }
    container.innerHTML = html;
}

function startTimer(seconds) {
    let remaining = seconds;
    updateTimerDisplay(remaining);
    STATE.timerInterval = setInterval(() => {
        remaining--;
        updateTimerDisplay(remaining);
        if (remaining <= 0) {
            clearInterval(STATE.timerInterval);
            endTest(false);
        }
    }, 1000);
}

function startStopwatch() {
    STATE.timerInterval = setInterval(() => {
        const elapsed = Math.floor((Date.now() - STATE.startTime) / 1000);
        document.getElementById('testTimer').textContent = 
            `${String(Math.floor(elapsed/60)).padStart(2,'0')}:${String(elapsed%60).padStart(2,'0')}`;
    }, 1000);
}

function updateTimerDisplay(s) {
    document.getElementById('testTimer').textContent = 
        `${String(Math.floor(s/60)).padStart(2,'0')}:${String(s%60).padStart(2,'0')}`;
    document.getElementById('testTimer').style.color = s <= 300 ? 'var(--red)' : 'var(--gold)';
}

// ==================== ANALYTICS ====================
function updateAnalytics() {
    const total = DB.stats.correct + DB.stats.incorrect;
    const pct = total > 0 ? Math.round(DB.stats.correct / total * 100) : 0;
    
    document.getElementById('predictionPct').textContent = pct + '%';
    document.getElementById('anTotalTests').textContent = DB.stats.tests;
    document.getElementById('anTotalQ').textContent = total;
    document.getElementById('anBestStreak').textContent = DB.stats.bestStreak;
    document.getElementById('anStudyDays').textContent = DB.stats.studyDays;
    
    let subjectsHtml = '';
    for (const [key, sub] of Object.entries(DB.subjects)) {
        const subPct = sub.total > 0 ? Math.round(sub.correct / sub.total * 100) : 0;
        subjectsHtml += `
            <div class="subject-item">
                <div class="subject-icon" style="background:${sub.color}20">${sub.icon}</div>
                <div class="subject-info">
                    <div class="subject-name">${sub.name}</div>
                    <div class="subject-bar">
                        <div class="subject-bar-fill" style="width:${subPct}%;background:${sub.color}"></div>
                    </div>
                </div>
                <div class="subject-pct" style="color:${sub.color}">${subPct}%</div>
            </div>
        `;
    }
    document.getElementById('subjectsAnalytics').innerHTML = subjectsHtml;
    
    // Recomendaciones
    let recsHtml = '';
    const weakest = Object.entries(DB.subjects).sort((a,b) => {
        const pctA = a[1].total > 0 ? a[1].correct / a[1].total : 1;
        const pctB = b[1].total > 0 ? b[1].correct / b[1].total : 1;
        return pctA - pctB;
    })[0];
    
    if (weakest && weakest[1].total > 0) {
        recsHtml += `
            <div style="display:flex;gap:15px;padding:20px;background:var(--bg);border-radius:12px;border:1px solid var(--border)">
                <div style="width:50px;height:50px;border-radius:12px;background:rgba(239,68,68,.15);display:flex;align-items:center;justify-content:center;font-size:1.5rem">üéØ</div>
                <div>
                    <h4 style="margin-bottom:5px">Refuerza ${weakest[1].name}</h4>
                    <p style="color:var(--text3);font-size:.85rem">Tu materia m√°s d√©bil. Dedica tiempo extra hoy.</p>
                </div>
            </div>
        `;
    }
    
    recsHtml += `
        <div style="display:flex;gap:15px;padding:20px;background:var(--bg);border-radius:12px;border:1px solid var(--border)">
            <div style="width:50px;height:50px;border-radius:12px;background:rgba(16,185,129,.15);display:flex;align-items:center;justify-content:center;font-size:1.5rem">üî•</div>
            <div>
                <h4 style="margin-bottom:5px">¬°Mant√©n la racha!</h4>
                <p style="color:var(--text3);font-size:.85rem">Mejor racha: ${DB.stats.bestStreak}. ¬°Sup√©rala!</p>
            </div>
        </div>
        <div style="display:flex;gap:15px;padding:20px;background:var(--bg);border-radius:12px;border:1px solid var(--border)">
            <div style="width:50px;height:50px;border-radius:12px;background:rgba(99,102,241,.15);display:flex;align-items:center;justify-content:center;font-size:1.5rem">‚è∞</div>
            <div>
                <h4 style="margin-bottom:5px">Simulacro semanal</h4>
                <p style="color:var(--text3);font-size:.85rem">Haz 100 preguntas cada domingo para medir tu nivel real.</p>
            </div>
        </div>
    `;
    document.getElementById('recommendations').innerHTML = recsHtml;
}

function updateGlobalStats() {
    const total = DB.stats.correct + DB.stats.incorrect;
    const pct = total > 0 ? Math.round(DB.stats.correct / total * 100) : 0;
    document.getElementById('globalTests').textContent = DB.stats.tests;
    document.getElementById('globalAcc').textContent = pct + '%';
    document.getElementById('globalStreak').textContent = DB.stats.bestStreak;
}

// ==================== PLAN ====================
const SCHEDULE = [
    { day: 'Lunes', tasks: ['<span class="task-tag tag-tests">20 Tests CE</span>', '<span class="task-tag tag-pdf">PDF T√≠tulo I</span>'] },
    { day: 'Martes', tasks: ['<span class="task-tag tag-tests">20 Tests CP</span>', '<span class="task-tag tag-pdf">PDF Delitos</span>'] },
    { day: 'Mi√©rcoles', tasks: ['<span class="task-tag tag-tests">20 Tests D.210</span>', '<span class="task-tag tag-pdf">PDF Escalas</span>'] },
    { day: 'Jueves', tasks: ['<span class="task-tag tag-tests">20 Tests Tr√°fico</span>', '<span class="task-tag tag-pdf">PDF Vial</span>'] },
    { day: 'Viernes', tasks: ['<span class="task-tag tag-repaso">Repaso Errores</span>', '<span class="task-tag tag-tests">15 Tests Mix</span>'] },
    { day: 'S√°bado', tasks: ['<span class="task-tag tag-sim">Simulacro 50</span>'] },
    { day: 'Domingo', tasks: ['<span class="task-tag tag-repaso">Descanso Activo</span>'] }
];

const QUOTES = [
    { text: "El dolor de la disciplina pesa gramos, el del arrepentimiento pesa toneladas.", author: "Jim Rohn" },
    { text: "El √©xito no es un accidente. Es trabajo duro, perseverancia y amor por lo que haces.", author: "Pel√©" },
    { text: "No cuentes los d√≠as, haz que los d√≠as cuenten.", author: "Muhammad Ali" },
    { text: "A LAS ARMAS, GUERRERO. LA PLAZA ES TUYA.", author: "Plan Santo Grial" },
    { text: "30 minutos diarios construyen imperios. T√∫ est√°s construyendo el tuyo.", author: "Plan Santo Grial" },
    { text: "Cada test que haces te acerca un paso m√°s a la placa.", author: "Plan Santo Grial" }
];

function renderSchedule() {
    const days = ['lun', 'mar', 'mie', 'jue', 'vie', 'sab', 'dom'];
    let html = '';
    SCHEDULE.forEach((item, i) => {
        const dayKey = days[i];
        const done = DB.plan.days[dayKey];
        html += `
            <tr>
                <td><strong>${item.day.substring(0,3).toUpperCase()}</strong></td>
                <td>${item.tasks.join(' ')}</td>
                <td class="check-cell">
                    <button class="check-btn${done ? ' done' : ''}" onclick="toggleDay('${dayKey}')">${done ? '‚úì' : ''}</button>
                </td>
            </tr>
        `;
    });
    document.getElementById('scheduleBody').innerHTML = html;
}

function toggleDay(day) {
    DB.plan.days[day] = !DB.plan.days[day];
    if (DB.plan.days[day]) DB.stats.studyDays++;
    saveToStorage();
    renderSchedule();
    updatePlanUI();
}

function updatePlanUI() {
    document.getElementById('weekBadge').textContent = 'SEMANA ' + DB.plan.week;
    const target = DB.plan.week <= 4 ? 70 : DB.plan.week <= 8 ? 80 : 85;
    document.getElementById('weekTarget').textContent = 'üéØ Target: ' + target + '%';
    
    const total = DB.stats.correct + DB.stats.incorrect;
    const pct = total > 0 ? Math.round(DB.stats.correct / total * 100) : 0;
    document.getElementById('weekProgressFill').style.width = pct + '%';
    document.getElementById('weekPct').textContent = pct + '%';
}

function newQuote() {
    const q = QUOTES[Math.floor(Math.random() * QUOTES.length)];
    document.getElementById('motivationQuote').textContent = '"' + q.text + '"';
    document.getElementById('motivationAuthor').textContent = '‚Äî ' + q.author;
}

// ==================== KEYBOARD SHORTCUTS ====================
document.addEventListener('keydown', e => {
    if (document.getElementById('testArea').classList.contains('active')) {
        if (['1','2','3','4'].includes(e.key) && !STATE.answered) {
            answerQuestion(parseInt(e.key) - 1);
        }
        if (e.key === 'Enter' && STATE.answered) nextQuestion();
        if (e.key === 'Escape') endTest(false);
    }
});
</script>
</body>
</html>
